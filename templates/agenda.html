{% include 'models/header.html' %}
<style>
  .fa-trash {
    color: #dc3545;
    cursor: pointer;
  }
  .fa-trash:hover {
    color: #a71d2a;
  }
  .fa-pen-to-square {
    color: #007bff;
    cursor: pointer;
  }
  .fa-pen-to-square:hover {
    color: #0056b3;
  }
</style>
<div class="container">
  <div class="header-title">
    <h2>Ultimos Agendamentos</h2>
    <a href="/agenda/evento" class="btn-novoagendamento">
        <i class="fa-solid fa-plus"></i> Novo Agendamento
    </a>
  </div>
  
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Título</th>
          <th>Data de Criação</th>
          <th>Data do Evento</th>
          <th>Usuário</th>
          <th>Local</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
      {% for evento in eventos %}
      <tr {% if evento.get_evento_atrasado %} style="color: red;"{% endif %}>
        <td>{{ evento.titulo }}</td>
        <td>{{ evento.get_data_criacao }}</td>
        <td>{{ evento.get_data_evento }}</td>
        <td>{{ evento.usuario }}</td>
        <td>{{ evento.local }}</td>
        <td>
          <a href="/agenda/evento/{{ evento.id }}" class="btn-editar"><i class="fa-solid fa-pen-to-square"></i></a>
          <a href="/agenda/evento/delete/{{ evento.id }}/" class="btn-deletar">
          <i class="fa-solid fa-trash"></i>
          </a>
        </td>
      </tr>
      {% endfor %} 
        {% if not eventos %}
        <tr>
          <td colspan="6" class="no-data">Nenhum agendamento encontrado</td>
        </tr>
        {% endif %}
      </tbody>
    </table>
  </div>
</div>

{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'success' %}
            <div id="success-toast" data-message="{{ message }}" style="display: none;"></div>
        {% endif %}
    {% endfor %}
{% endif %}
  
{% include 'models/footer.html' %}

<!-- ADICIONADO: Script para o modal de confirmação e o toast de sucesso -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Modal de Confirmação para Exclusão ---
    const deleteButtons = document.querySelectorAll('.btn-deletar');
    // --- Notificação Toast para Mensagens de Sucesso ---
    // Procura por um elemento com a mensagem de sucesso vinda do backend
    const successToast = document.getElementById('success-toast');
    if (successToast && successToast.dataset.message) {
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3500,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer);
                toast.addEventListener('mouseleave', Swal.resumeTimer);
            }
        });

        Toast.fire({
            icon: 'success',
            title: successToast.dataset.message
        });
    }
});
</script>